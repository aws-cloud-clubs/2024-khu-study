# 2장. 개략적인 규모 추정

## 응답지연 값
- L1 캐시 참조시간은 L2 캐시 참조시간에 비해 14배가량 빠르고, 주 메모리 참조시간에 비해 200배가량 빠르다.
- 뮤텍스 락/언락시간은 주 메모리 참조 시간과 거의 비슷한 수준으로 느리다. 따라서 불필요한 뮤텍스 락을 최대한 없애는 방향으로 생각해야 한다.
- 나노초라는 단위가 잘 와닿지 않는다. 그래서 1초에 몇번 연산을 수행할 수 있는지로 생각해보면 좋을것 같다. L1 캐시 참조가 0.5ns가 걸리니 1초에 2*10^9 = 2,000,000,000 = 20억회 연산을 수행할 수 있다. 어마무시하고마잉..
- 한 패킷이 캘리포니아에서 네덜란드까지 왕복하는데 걸리는 시간은 150ms = 0.15초이다. 캘리포니아에서 네덜란드까지 비행기로 왕복하려면 24시간 걸린다는점을 감안하면 어마어마하게 빠른 수치이다.
- 네트워크에서 1MB를 읽는 시간이 10ms인데 반해 디스크에서 읽은 시간은 30ms로 3배가량 느리다. 디스크가 네트워크에 비해 물리적으로 훨씬 가까운 곳에 저장된다는 점에 빗대어보면 디스크에서 읽는 것이 느리다는 사실이 꽤 신기하다. 앞서 캘리포니아에서 네덜란드까지 패킷의 왕복 지연시간이 0.15초라는점을 감안해도 여전히 네트워크에서 데이터를 읽는 것이 디스크에서 읽는것보다 더 빠를것이라고 추정할 수 있다.
- 디스크 탐색은 정확히 뭘 하는건지 잘 모르겠다. 디스크 내에서 특정 파일을 찾는데 걸리는 시간을 말하는 것인가?
- 같은 데이터센터 내에서는 메세지 왕복 지연시간이 500마이크로세컨드이다. 캘리포니아에서 네덜란드까지 패킷 왕복 지연시간보다 300배 빠르다. 지리적으로 가까운 것은 분명한 이점이 있다.
- 네트워크에서 읽는 것이 디스크에서 읽는 것보다 더 빠르다는것을 생각하면 자주 사용되지는 않지만 여러 서비스에서 공유하여 사용해야하는 데이터들은 따로 데이터 서버를 두어서 처리하는것이 속도 측면에서도 이점을 가진다고 볼수 있다.
- 메모리에서 1MB를 읽는 것은 250마이크로세컨드가 걸린다. 이는 디스크에서 읽는것보다 120배 빠르고 네트워크에서 읽는것보다 40배 빠르다.
- Zippy 압축 알고리즘은 텍스트기반 로그파일을 10배가량 압축하는 효과가 있다.[참조](https://originalchoi.tistory.com/entry/%EC%95%95%EC%B6%95%ED%8C%8C%EC%9D%BC-%EC%84%B1%EB%8A%A5%EB%B9%84%EA%B5%90tar-zip-gz-bz2) 1Gbps 네트워크로 20KB 로그파일을 전송한다고 생각하면, 압축을 하지 않았을 때는 200마이크로초가 걸리지만, 압축을 한 뒤 전송하면 200 + 20 = 220 마이크로초가 걸린다. 단순 계산만 가지고 보면 더 오래 걸리지만, 네트워크 트래픽을 10배 줄여준다는 점, 네트워크가 느려질수록 효율이 좋아질 것이라는 점, 압축하는 컴퓨터의 성능이 좋을수록 더 속도를 끌어올릴수 있다는 점들을 고려하면 압축을 해서 보내는것이 전체적으로 훨씬 좋은 방법이라고 생각할 수 있다.
- 우리집 네트워크 속도측정을 해보니 70Mbps가 나왔다. 1Gbps에 비해 무려 15배가량 느리다. 무조건 압축을 하는 것이 좋을것 같다.

## 가용성
- 가용성은 퍼센트로 표시하고 100%에 가까울수록 시스템이 중단된적이 없음을 의미한다.
- 9가 많으면 좋다. (99%, 99.9%, 99.99% ...)
- 99%의 가용률이라고 하면 매우 좋은 수치처럼 보이지만 하루당 장애시간이 14.40분, 주당 장애시간이 1.68시간, 연간 장애시간이 무려 3.65일이다.

## 추정
- QPS(Query Per Second) - 하루에 발생하는 쿼리의 양을 대략 추정한 후 24*60*60으로 나눈다.
- 최대 QPS는 어떻게 추정하는게 좋을까? 예제에서는 QPS의 2배를 한것 같은데, 이건 서비스의 시간별 사용량 분포에 따라 다를것 같다.
- 트위터는 트윗의 양이 워낙 많아서 그런가 tweet_id에 무려 64바이트나 할당하는 모습이다. 모통 id로 사용하는 long타입이 8바이트임을 고려하면 무려 8배나 크다. UUID보다도 4배나 크다.
- 미디어는 텍스트에 비해 용량이 매우 크다. 예제에서는 미디어의 용량이 tweet_id와 텍스트를 합친 것보다 5000배 크다. 
