# Chap 13. 검색어 자동완성 시스템

가장 많이 이용된 검색어 k개를 자동완성하여 출력하는 시스템 설계

### 1단계: 문제 이해 및 설계 범위 확정

- 빠른 응답 속도
- 연관성
- 정렬
- 규모 확장성
- 고가용성

### 2단계: 개략적 설계안 제시 및 동의 구하기

- 데이터 수집 서비스(data gathering service): 사용자가 입력한 질의를 실시간으로 수집하는 시스템
- 질의 서비스(query service): 주어진 질의에 다섯 개의 인기 검색어를 정렬하는 시스템

### 3단계: 상세 설계

**트라이 자료구조**

- 트라이는 트리 형태의 자료구조
- 이 트리의 루트 노드는 빈 문자열을 나타냄
- 각 노드의 글자 하나를 저장하며, 26개의 자식 노드를 가질 수 있다.
- 각 트리 노드는 하나의 단어, 또는 접두어 문자열(prefix string)을 나타낸다.

최적화를 위한 방법

1. 접두어의 최대 길이를 제한
2. 각 노드에 인기 검색어를 캐시

**데이터 수집 서비스**

데이터 분석 서비스 로그 -> 로그 취합 서버 -> 취합된 데이터 -> 작업 서버 --매주 갱신--> 트라이 데이터베이스 --매주 데이터베이스의 상태를 스냅샷--> 트라이 캐시

트라이 데이터베이스 선택지
1. Document store
2. Key-value store

**질의 서비스**

최적화 방안
- AJAX 요청
- 브라우저 캐싱

**규모 확장이 가능한 저장소**

검색어 대응 샤드 관리자와 샤드가 있는 데이터베이스와 웹서버가 통신한다. 검색어의 횟수에 따라 샤드를 분리한다.

**트라이 연산**

트라이 갱신 방법
1. 매주 한 번 갱신하는 방법. 새로운 트라이를 만든 다음에 기존 트라이 대체
2. 트라이의 각 노드를 개별적으로 갱신하는 방법

필터 계층을 두어 규칙에 따라 검색 결과를 자유롭게 변경할 수 있다.

### 4단계: 마무리

- 다국어 지원: 유니코드 데이터 저장
- 국가별 인기 검색어 순위가 다르다면 국가별로 다른 트라이 사용
- 샤딩을 통하여 작업 대상 데이터의 양을 줄인다.
- 순위 모델를 바꾸어 최근 검색어에 보다 높은 가중치를 주도록 한다.


