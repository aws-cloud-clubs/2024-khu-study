# Chap 1. 사용자 수에 따른 규모 확장성

## 서버 아키텍처와 데이터베이스

초기 : 웹, 앱, 데이터베이스, 캐시 등이 단일 서버에서 실행되는 **단일 서버 시스템**을 사용

사용자가 도메인 이름으로 웹사이트에 접속하면 DNS 조회를 통해 IP 주소를 얻은 후, 해당 IP로 HTTP 요청을 보내고 웹 서버가 HTML, JSON 등의 형태로 응답을 반환

사용자가 증가하면 웹/모바일 트래픽 처리용(웹 계층), 데이터베이스용(데이터 계층) 등으로 서버를 분리하여 각각을 독립적으로 확장

- **관계형 데이터베이스** (MySQL, Oracle, PostgreSQL): 자료를 테이블, 열, 칼럼으로 표현하고 SQL로 여러 테이블을 조인 가능
- **비 관계형 데이터베이스** (CouchDB, Neo4j, HBase, DynamoDB): 키-값 저장소, 그래프 저장소, 칼럼 저장소, 문서 저장소로 나누어지며 일반적으로 조인 연산을 지원 X
비정형 데이터를 다루거나 아주 많은 양의 데이터를 저장해야 하고, 데이터 직렬화/역직렬화만 가능하면 되며, 낮은 응답지연시간이 요구될 때 비 관계형 데이터베이스 사용

## 규모 확장 방식

- **수직적 규모 확장 (Scale Up)**: 서버에 고사양 자원(CPU, RAM)을 추가하는 방식으로, 유입되는 트래픽 양이 적은 경우 적절하고 단순하지만 확장에 한계가 있고 장애 대응 방안이 없음
- **수평적 규모 확장 (Scale Out)**: 더 많은 서버를 추가하여 성능을 개선하는 방식으로, 대규모 애플리케이션에 적절

## 로드 밸런싱과 다중화

- **로드 밸런서**: 웹 서버에 트래픽 부하를 고르게 분산시키는 역할을 하며, 장애 자동복구(failover) 문제를 해결하고 웹 계층의 가용성(availability) 향상
- **데이터베이스 다중화**: 서버 사이에 주(master)-부(slave) 관계를 설정하여 데이터 원본은 주 서버에, 사본은 부 서버에 저장
쓰기 연산은 주 서버에서만 지원하고 읽기 연산은 부 서버에서 지원하므로 병렬 처리 가능한 쿼리 수가 증가하여 성능이 향상되고, 데이터 보존성과 가용성 높아짐

## 캐시과 CDN

- **캐시**: 값비싼 연산 결과나 자주 참조되는 데이터를 메모리에 두고 뒤이은 요청을 빠르게 처리할 수 있도록 하는 저장소
별도의 캐시 계층을 두면 성능 개선, 데이터베이스 부하 감소, 독립적 확장이 가능
읽기 주도형 캐시 전략 등 다양한 전략이 있으며, 영속적 데이터는 지속적 저장소에 두고 만료 정책 필수
- **콘텐츠 전송 네트워크 (CDN)**: 정적 콘텐츠를 전송하는 지리적으로 분산된 서버 네트워크로, 이미지, 비디오, CSS, JS 파일 등 캐시 가능
사용자에게 가장 가까운 CDN 서버가 정적 콘텐츠 전달

## Stateless 웹 계층과 데이터 센터

- **Stateless 웹 계층**: 웹 계층의 수평적 확장을 위해 상태 정보(세션 등)를 웹 계층에서 제거하고 관계형DB나 NoSQL 같은 지속성 저장소에 보관한 후 필요할 때 사용
- **데이터 센터**: 사용자는 지리적으로 가까운 데이터 센터로 안내되며(geoDNS-routing), 한 데이터 센터에 장애가 발생하면 다른 데이터 센터로 트래픽 전송
다중 데이터센터 아키텍처를 구축할 때는 트래픽 우회, 데이터 동기화, 테스트와 배포 등의 기술적 난제를 해결 필요

## 메시지 큐와 모니터링

- **메시지 큐**: 메시지의 무손실(durability)을 보장하는 비동기 통신을 지원하는 컴포넌트로, 서비스/서버 간 결합을 느슨하게 하여 규모 확장성을 보장하는 안정적 애플리케이션 구성에 적합
- **로그, 메트릭, 자동화**: 로그를 통한 서버 단위 모니터링, 메트릭을 통해 시스템 현황 파악(호스트/종합/비즈니스 메트릭), 자동화 도구 활용을 통해 생산성 향상

## 데이터베이스 규모 확장

- **수직적 확장 (Scale Up)**: 기존 서버에 더 많은 자원을 증설하는 방식으로 성능 향상에 한계가 있고 SPOF 위험과 높은 비용이 단점
- **수평적 확장 (Sharding)**: 대규모 데이터베이스를 샤드(shard)라는 작은 단위로 분할하는 기술로, 샤딩 키(sharding key) 선택 잘 해야 함
문제점 : 데이터 재샤딩, 유명인사 문제, 조인과 비정규화 등

## 백만 사용자 이상의 경우

- 웹 계층 = stateless
- 모든 계층에 다중화 도입
- 가능한 한 많은 데이터를 캐시할 것
- 여러 데이터 센터 지원
- 정적 콘텐츠는 CDN을 통해 서비스
- 데이터 계층은 샤딩을 통해 규모 확장
- 각 계층은 독립적 서비스로 분할
- 시스템 지속적으로 모니터링, 자동화 도구 활용
