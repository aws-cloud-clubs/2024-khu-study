# Chap 5. 안정 해시 설계

**해시 키 재배치(rehash) 문제**
sererIndex = hash(key) % N (N은 서버의 개수)

서버가 추가되거나 기존 서버가 삭제되었을 때 서버 인덱스값은 달라진다. 대부분의 키가 재분배되어 대큐모 캐시 미스가 발생한다.

**안정 해시**
: 해시 테이블 크기가 조정될 때 평균적으로 오직 k/n개의 키만 재배치하는 해시 기술이다. (k는 키의 개수, n은 슬롯의 개수)
<img width="594" alt="스크린샷 2024-05-27 오후 3 48 16" src="https://github.com/aws-cloud-clubs/2024-khu-study/assets/56192209/197cb3dd-4238-465f-9fd8-e25d4eeef7fa">

- 서버와 키를 균등 분포 해시 함수를 사용해 해시 링에 배치한다.
- 키의 위치에서 링을 시계 방향으로 탐색하다 만나는 최초의 서버가 키가 저장될 서버다.

이 접근법에 두가지 문제 발생

1. 파티션(인접한 서버 사이의 해시 공간)의 크기를 균등하게 유지하는 게 불가능
2. 키의 균등 분포를 달성하기 어렵다. → 가상 노드(virtual node) 또는 복제(replica) 기법으로 해결

안정 해시의 이점

- 서버가 추가/삭제 시 재배치되는 키의 수가 최소화된다.
- 데이터가 보다 균등하게 분포하게 되므로 수평적 규모 확장성을 달성하기 쉽다.
- 핫스팟 키 문제를 줄인다.